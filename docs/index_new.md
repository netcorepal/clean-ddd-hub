# CleanDDD 的定义

## 什么是 CleanDDD？

CleanDDD 即 Clean Domain-Driven Design , 是基于领域驱动设计 (DDD) 的核心理念，经过概念简化和重构，形成的一套实用的软件工程指南，它包含了四个重要组成部分：

- 一个价值取向
- 一组概念定义
- 一种建模方法
- 一套代码规范

## CleanDDD 的目标

通过明确的概念定义和易于遵守的原则，避免代码快速腐化陷入混乱不可维护的困境，帮助开发者掌控复杂的软件系统，保持对软件系统和代码的掌控力，从而实现可持续的快速迭代和交付能力。

## CleanDDD 的价值取向

保持边界明确是最重要的事。

## CleanDDD 的概念定义

聚合
领域事件
领域事件处理器
命令与命令处理器
查询与查询处理器

## CleanDDD 的建模方法

- 识别聚合
  - 第一步，当你识别到`创建 x`的需求时，很可能 x 就是一个聚合
  - 第二步，当你发现 `x` 无法独立存在，需要依附到另一个实体时，`x` 就可以定义为该实体的子实体
- 识别命令与命令处理器
  - 当你发现某个操作需要修改聚合的状态时，这个操作就可以定义为一个命令
  - 一般来说，命令由如下情形触发：
    - 用户操作（如通过 UI 提交表单）
    - 领域事件处理器
    - 定时任务
- 识别领域事件
  - 领域事件通常以过去式命名，表示某个重要业务事件已经发生
  - 领域事件的命名应反映业务含义，例如 `OrderCreated`、`CustomerAddressUpdated`
- 识别领域事件处理器
  - 当识别到“当做x操作后，要做y操作”的需求时，y 操作就需要由一个领域事件处理器来触发
  - 每个领域事件处理器应专注于处理单一的领域事件，确保职责清晰
- 识别查询
  - 当识别到用户需要查看聚合数据时，这个操作就可以定义为一个查询
  - 当某些业务规则的判断需要基于聚合数据时，这个操作也可以定义为一个查询

## CleanDDD 的代码规范

- 聚合
  - 聚合之间不允许直接相互引用
  - 聚合之间不共享实体，即不允许通过子实体对象引用其他聚合
  - 聚合内的对象只能通过聚合根或者其子实体的方法进行修改
  - 聚合的属性变更必须通过聚合的行为（方法）来完成
- 领域事件
  - 领域事件必须由聚合的行为来产生
- 命令处理器
  - 命令处理器只能修改单个聚合
- 事件处理器
  - 一个事件处理器只能处理单个领域事件
- 查询
  - 不允许跨聚合的Join查询

## Q&A

### CleanDDD 与 Clean Architecture 关系是怎样的？

CleanDDD 与 Clean Architecture 并无直接关系，仅在代码组织方式上有一定的相似性，但两者的关注点和目标不同，涉及到的分层概念也不完全相同。CleanDDD 的 `Clean` 更多的是强调其对于复杂概念的简化和以及实践便捷性，而不是指代某种特定的架构风格。

### 基于 CleanDDD 开发的软件，性能会不会很差？

不会，大部分业务系统都是 I/O 密集型的，并且是读多写少的场景，由于 CleanDDD 强调聚合边界的明确划分，要求不允许跨聚合的直接引用和操作，天然会存在一定的信息冗余存储在聚合中，从而减少跨聚合的数据访问需求，反倒提升了系统的整体性能。
